<html>
<head>
    <script src="../dist/vanage.min.js"></script>
</head>
<body>
    <script>
        Vanage.set('debug', true);
        
        Vanage.register({
            module: 'error'
        }, (args, done) => {
            if(args.error) {
                throw new Error(args.error + ' (delegated from ' + JSON.stringify(args.__delegate__) + ' with data ' + JSON.stringify(args.origin) + ')');
            } else {
                // no error available, simply skip ... 
                done(null);
            }
        });
        
        Vanage.register({
            module: 'appcache',
            event: 'ready'
        }, (args, done) => {
            if(args.state === 3) { // updateready
                done(null, window.applicationCache);
            } else {
                done(('Appcache status is not updateready!'));
            }
        });

        Vanage.delegate({
            module: 'appcache',
            event: 'error'
        }, (delegate, data) => {
            delegate({ module: 'error' }, data);
        });

        Vanage.act({
            module: 'appcache',
            event: 'ready'
        }, {
            state: window.applicationCache.UPDATEREADY
        }, (err, result, delegate) => {
            if(err) {
                delegate({
                    module: 'appcache',
                    event: 'error'
                }, {
                    error: err
                });

                return false;
            }

            if(confirm('Cache is updateready, swap and reload?')) {
                result.swap();
                window.location.reload();
            }
        });
    </script>
</body>
</html>