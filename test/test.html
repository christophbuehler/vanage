<html>
<head>
    <script src="../dist/service.js"></script>
</head>
<body>
    <script>
        Service.set('debug', true);
        
        Service.register({
            module: 'error'
        }, (args, done) => {
            if(args.error) {
                done(new Error(args.error));
            } else {
                done(null);
            }
        });
        
        Service.register({
            module: 'appcache',
            event: 'ready'
        }, (args, done) => {
            if(args.state === 3) { // updateready
                done(null, window.applicationCache);
            } else {
                done(('Appcache status is not updateready!'));
            }
        });

        Service.delegate({
            module: 'appcache',
            event: 'error'
        }, (delegate, data) => {
            delegate({ module: 'error' }, data);
        });

        Service.act({
            module: 'appcache',
            event: 'ready'
        }, {
            state: window.applicationCache.UPDATEREADY
        }, (err, result, delegate) => {
            if(err) {
                delegate({
                    module: 'appcache',
                    event: 'error'
                }, {
                    error: err
                });

                return false;
            }

            if(confirm('Cache is updateready, swap and reload?')) {
                result.swap();
                window.location.reload();
            }
        });

        Service.register('invalid', () => {});

        console.log(Service)

    </script>
</body>
</html>