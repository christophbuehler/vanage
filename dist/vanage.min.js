!function(e){if("object"==typeof exports&&"undefined"!=typeof module)module.exports=e();else if("function"==typeof define&&define.amd)define([],e);else{var t;t="undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:this,t.Vanage=e()}}(function(){return function e(t,n,r){function i(u,s){if(!n[u]){if(!t[u]){var f="function"==typeof require&&require;if(!s&&f)return f(u,!0);if(o)return o(u,!0);var c=new Error("Cannot find module '"+u+"'");throw c.code="MODULE_NOT_FOUND",c}var a=n[u]={exports:{}};t[u][0].call(a.exports,function(e){var n=t[u][1][e];return i(n?n:e)},a,a.exports,e,t,n,r)}return n[u].exports}for(var o="function"==typeof require&&require,u=0;u<r.length;u++)i(r[u]);return i}({1:[function(e,t,n){"use strict";var r=e("./src/utils/uuid"),i=e("./src/Service"),o=e("./src/Cache");e("./src/Error");t.exports=function(e){return{Cache:o,Service:i,create:function t(e){return e=e||{debug:!1},new i(e)},generateId:r}}()},{"./src/Cache":3,"./src/Error":4,"./src/Service":6,"./src/utils/uuid":15}],2:[function(e,t,n){function r(){d&&a&&(d=!1,a.length?l=a.concat(l):p=-1,l.length&&i())}function i(){if(!d){var e=s(r);d=!0;for(var t=l.length;t;){for(a=l,l=[];++p<t;)a&&a[p].run();p=-1,t=l.length}a=null,d=!1,f(e)}}function o(e,t){this.fun=e,this.array=t}function u(){}var s,f,c=t.exports={};!function(){try{s=setTimeout}catch(e){s=function(){throw new Error("setTimeout is not defined")}}try{f=clearTimeout}catch(e){f=function(){throw new Error("clearTimeout is not defined")}}}();var a,l=[],d=!1,p=-1;c.nextTick=function(e){var t=new Array(arguments.length-1);if(arguments.length>1)for(var n=1;n<arguments.length;n++)t[n-1]=arguments[n];l.push(new o(e,t)),1!==l.length||d||s(i,0)},o.prototype.run=function(){this.fun.apply(null,this.array)},c.title="browser",c.browser=!0,c.env={},c.argv=[],c.version="",c.versions={},c.on=u,c.addListener=u,c.once=u,c.off=u,c.removeListener=u,c.removeAllListeners=u,c.emit=u,c.binding=function(e){throw new Error("process.binding is not supported")},c.cwd=function(){return"/"},c.chdir=function(e){throw new Error("process.chdir is not supported")},c.umask=function(){return 0}},{}],3:[function(e,t,n){"use strict";function r(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}var i=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),o=function(){function e(){r(this,e),this.name="Vanage.Cache",this.internals={},this.dirty=!1}return i(e,[{key:"set",value:function t(e,n){this.internals[e]=n,this.dirty=!0}},{key:"get",value:function n(e){return this.internals[e]}},{key:"flush",value:function o(){this.internals={}}},{key:"dump",value:function u(){return this.internals}},{key:"isDirty",value:function s(){return this.dirty}},{key:"size",get:function f(){return this.entries.length}},{key:"entries",get:function c(){return Object.keys(this.internals)}}]),e}();t.exports=o},{}],4:[function(e,t,n){"use strict";function r(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function i(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function o(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}var u=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),s=function(e){function t(e){r(this,t);var n=i(this,Object.getPrototypeOf(t).call(this,e));return n.name=n.constructor.name,n.message=e,n.stamp=Date.now(),n.callee="<unknown>","function"==typeof Error.captureStackTrace?Error.captureStackTrace(n,n.constructor):n.stack=new Error(e).stack,n}return o(t,e),u(t,[{key:"toString",value:function n(){return"["+this.name+"#"+this.callee+"] "+this.message+" @ "+this.stamp}}]),t}(Error),f=function(e){function t(e){return r(this,t),i(this,Object.getPrototypeOf(t).call(this,e))}return o(t,e),t}(s),c=function(e){function t(e){r(this,t);var n=i(this,Object.getPrototypeOf(t).call(this,e));return n.name="DelegationError",n.callee="Service.delegate",n}return o(t,e),t}(s),a=function(e){function t(e){r(this,t);var n=i(this,Object.getPrototypeOf(t).call(this,e));return n.name="ActError",n.callee="Service.act",n}return o(t,e),t}(s),l=function(e){function t(e){r(this,t);var n=i(this,Object.getPrototypeOf(t).call(this,e));return n.name="RegisterError",n.callee="Service.register",n}return o(t,e),t}(s);n.InternalBaseError=s,n.VanageError=f,n.DelegationError=c,n.ActError=a,n.RegisterError=l},{}],5:[function(e,t,n){"use strict";function r(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}var i=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),o=e("./Signature"),u=e("./utils/equal"),s=e("./utils/uuid"),f=function(){function e(t){r(this,e),this.name="Vanage.Pattern",this.base=t,this.unique=s(),this.id=new o(this.unique,this.base)}return i(e,[{key:"match",value:function t(e){return u(this.base,e)}},{key:"signature",get:function n(){return this.id.value}},{key:"keys",get:function f(){return Object.keys(this.base)}}]),e}();t.exports=f},{"./Signature":7,"./utils/equal":10,"./utils/uuid":15}],6:[function(e,t,n){(function(n){"use strict";function r(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}var i="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol?"symbol":typeof e},o=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),u=e("./utils/uuid"),s=e("./utils/noop"),f=e("./utils/debug"),c=e("./utils/stringify"),a=e("./utils/console"),l=e("./Error"),d=e("./Cache"),p=e("./Pattern"),y=e("./Signature"),h=function(){function e(t){r(this,e),this.name="Vanage.Service",this.options=t||{},this.id=t.identifier||u(),this.debug=s,this._internalId=Math.random().toString(36).slice(-12),this._history=new d,this._cache=new d,this._delegates=[],this._handlers=[]}return o(e,[{key:"configure",value:function t(e){if("object"===("undefined"==typeof e?"undefined":i(e)))for(var t in e)this.options[t]=e[t];this._postConfigHook()}},{key:"set",value:function h(e,t){this.options[e]=t,this._postConfigHook()}},{key:"find",value:function g(e){var t={delegates:[],handlers:[]};return this._handlers.forEach(function(n){n.pattern.match(e)&&t.handlers.push(n)}),this._delegates.forEach(function(n){n.pattern.match(e)&&t.delegates.push(n)}),t}},{key:"queue",value:function b(e,t){var n=[],r=[];return t=t||s,Array.isArray(e)?(e.forEach(function(e,t){r.push(function(e,t){e?n.push(e):r.push(t)}),e.apply(null,r),r.splice(t,1)}),t(n,r)):this.fail(new TypeError("[Service.queue] Queue needs an array with actions and not typeof "+("undefined"==typeof e?"undefined":i(e))))}},{key:"unregister",value:function v(e){var t=this,n=!1;return e instanceof y?(this._handlers.forEach(function(r,i){if(r.pattern.id.match(e))return f("[Service.unregister] Found handler to unregister with sign "+r.pattern.signature),t._handlers.splice(i,1),n=!0}),this._delegates.forEach(function(r,i){if(r.pattern.id.match(e))return f("[Service.unregister] Found delegate to unregister with sign "+r.pattern.signature),t._delegates.splice(i,1),n=!0}),n):this.fail(new TypeError("[Service.unregister] Cannot unregister by "+("undefined"==typeof e?"undefined":i(e))+", signature needed"))}},{key:"register",value:function m(e,t){var n=this;if(this.debug("[Service.register] Registring new handler for %s",c(e)),"object"!==("undefined"==typeof e?"undefined":i(e)))return this.fail(new TypeError("[Service.register] Endpoint target must be an object and not type "+("undefined"==typeof e?"undefined":i(e))));var r={pattern:new p(e),handler:t,rootService:n._internalId},o=this._handlers.push(r),u=this._handlers[o-1];return this._cache.set(u.pattern.signature,u),r.pattern.id}},{key:"delegate",value:function w(e,t){var n=this;if(this.debug("[Service.delegate] Registering delegate for %s",c(e)),"object"!==("undefined"==typeof e?"undefined":i(e)))return this.fail(new TypeError("[Service.delegate] Delegation ressource must be an object and not "+("undefined"==typeof e?"undefined":i(e))));if("function"!=typeof t)return this.fail(new TypeError("[Service.delegate] Delegators need a function to delegate, received "+("undefined"==typeof t?"undefined":i(t))));var r={pattern:new p(e),delegate:t,rootService:n._internalId},o=this._delegates.push(r),u=this._delegates[o-1];return this._cache.set(u.pattern.signature,u),r.pattern.id}},{key:"act",value:function S(e,t,n){var r=this;return t=t||{},n="function"==typeof n?n:s,e?(this.debug("[Service.act] %s for %s with data %s",t.__delegate__?"Delegating Action":"Acting",c(e),c(t)),this._history.set(new p(e).signature,{data:t,stamp:Date.now(),target:e,resolver:n}),this._delegates.forEach(function(o){o.pattern.match(e)&&(r.debug("[Service.delegate] Found delegation for %s",c(e)),o.delegate.apply(null,[function(o,u){"object"!==("undefined"==typeof u?"undefined":i(u))&&(u={}),u.origin=t,r.debug("[Service.delegate] Delegate target %s to %s",c(e),c(o)),u.__delegate__=e,r.act(o,u,n)}]))}),void this._handlers.forEach(function(o){o.pattern.match(e)&&o.handler.apply(null,[t,function(o,u){return r.debug("[Service.act] Handling factory %s with data %s",c(e),c(t)),n.apply(null,[o,u,function(n,o){"object"!==("undefined"==typeof o?"undefined":i(o))&&(o={}),o.__delegate__=e,o.origin=t,r.act(n,o)}])},function(o,u,s){"object"!==("undefined"==typeof u?"undefined":i(u))&&(u={}),u.origin=t,r.debug("[Service.register] Delegate target %s to %s",c(e),c(o)),u.__delegate__=e,r.act(o,u,s||n)}])})):this.fail(new l.ActError("[Service.act] No target defined to act event on"))}},{key:"fail",value:function _(e){var t="";return t+="["+e.name+"#"+(e.callee||"Callee::<unknown>")+"]",t+=e.message+" "+(e.stamp?"@ "+e.stamp:""),"function"==typeof a.error?a.error.apply(a,t):"function"==typeof a.log?a.log.apply(a,t):"function"==typeof a.write&&a.write.apply(n,t+"\n"),e}},{key:"_postConfigHook",value:function k(){this.debug=f(this.options.debug)}}]),e}();t.exports=h}).call(this,e("_process"))},{"./Cache":3,"./Error":4,"./Pattern":5,"./Signature":7,"./utils/console":8,"./utils/debug":9,"./utils/noop":13,"./utils/stringify":14,"./utils/uuid":15,_process:2}],7:[function(e,t,n){"use strict";function r(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}var i="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol?"symbol":typeof e},o=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),u=e("./utils/uuid"),s=e("./utils/equal"),f=function(){function e(t,n){r(this,e),this.identifier=n||{},this.unique=t||u()}return o(e,[{key:"match",value:function t(n){return n instanceof e&&(n.identifierKeys.length===this.identifierKeys.length&&(n.value===this.value&&s(n.identifier,this.identifier)))}},{key:"_stringifyObjectLike",value:function n(e){var t=this;if(Array.isArray(e))return e.join(",");if("string"==typeof e)return e;if("object"===("undefined"==typeof e?"undefined":i(e))){var n="",r=0;for(var o in e)Array.isArray(e[o])||"object"!==i(e[o])||(n+=t._stringifyObjectLike(e[o])),n+=0===r?"":"&",n+=o+":"+e[o],r++;return n}return JSON.stringify(e)}},{key:"value",get:function f(){var e=this.identifierKeys.length,t=this._stringifyObjectLike(this.identifier);return t+="@"+this.unique.replace(/-/g,"")+"#"+e}},{key:"identifierKeys",get:function c(){return Object.keys(this.identifier)||[]}}]),e}();t.exports=f},{"./utils/equal":10,"./utils/uuid":15}],8:[function(e,t,n){(function(e){"use strict";var n="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol?"symbol":typeof e};t.exports=function(){return void 0!==("undefined"==typeof console?"undefined":n(console))?console:e&&"function"==typeof e.stdout.write?e.stdout:void 0}}).call(this,e("_process"))},{_process:2}],9:[function(e,t,n){(function(n){"use strict";var r=e("./noop"),i=e("./console")();t.exports=function(e){if(e){if("function"==typeof i.debug)return i.debug.bind(i);if("function"==typeof i.log)return i.log.bind(i);if(n&&"function"==typeof n.stdout.write)return n.stdout.write.bind(n)}return r}}).call(this,e("_process"))},{"./console":8,"./noop":13,_process:2}],10:[function(e,t,n){"use strict";function r(e){return null===e||void 0===e}function i(e){return!(!e||"object"!==("undefined"==typeof e?"undefined":u(e))||"number"!=typeof e.length)&&("function"==typeof e.copy&&"function"==typeof e.slice&&!(e.length>0&&"number"!=typeof e[0]))}function o(e,t,n){var o=void 0,l=void 0,d=void 0,p=void 0;if(r(e)||r(t))return!1;if(e.prototype!==t.prototype)return!1;if(c(e))return!!c(t)&&(e=s.call(e),t=s.call(t),a(e,t,n));if(i(e)){if(!i(t))return!1;if(e.length!==t.length)return!1;for(o=0;o<e.length;o++)if(e[o]!==t[o])return!1;return!0}try{d=f(e),p=f(t)}catch(y){return!1}if(d.length!=p.length)return!1;for(d.sort(),p.sort(),o=d.length-1;o>=0;o--)if(d[o]!=p[o])return!1;for(o=d.length-1;o>=0;o--)if(l=d[o],!a(e[l],t[l],n))return!1;return("undefined"==typeof e?"undefined":u(e))===("undefined"==typeof t?"undefined":u(t))}var u="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol?"symbol":typeof e},s=Array.prototype.slice,f=e("./keys"),c=e("./isArguments"),a=t.exports=function(e,t,n){return n=n||{},e===t||(e instanceof Date&&t instanceof Date?e.getTime()===t.getTime():!e||!t||"object"!=("undefined"==typeof e?"undefined":u(e))&&"object"!=("undefined"==typeof t?"undefined":u(t))?n.strict?e===t:e==t:o(e,t,n))}},{"./isArguments":11,"./keys":12}],11:[function(e,t,n){"use strict";function r(e){return"[object Arguments]"==Object.prototype.toString.call(e)}function i(e){return e&&"object"==("undefined"==typeof e?"undefined":o(e))&&"number"==typeof e.length&&Object.prototype.hasOwnProperty.call(e,"callee")&&!Object.prototype.propertyIsEnumerable.call(e,"callee")||!1}var o="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol?"symbol":typeof e},u="[object Arguments]"==function(e){return Object.prototype.toString.call(arguments)}();t.exports=u?r:i,n.supported=r,n.unsupported=i},{}],12:[function(e,t,n){"use strict";function r(e){var t=[];for(var n in e)t.push(n);return t}n=t.exports=function(e){return"function"==typeof Object.keys?Object.keys:r}(),n.shim=r},{}],13:[function(e,t,n){"use strict";t.exports=function(){}},{}],14:[function(e,t,n){"use strict";t.exports=function(e){return"string"==typeof e?e:Array.isArray(e)?e.join(", "):void 0!==e.toISOString?e.toISOString():JSON.stringify(e)}},{}],15:[function(e,t,n){"use strict";var r=function i(){return Math.floor(65536*(1+Math.random())).toString(16).substring(1)};t.exports=function o(){return r()+r()+"-"+r()+"-"+r()+"-"+r()+"-"+r()+r()+r()}},{}]},{},[1])(1)});
//# sourceMappingURL=vanage.min.js.map
